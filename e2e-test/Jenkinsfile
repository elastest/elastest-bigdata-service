def elastest_url = ''
node('et_in_et'){
    elastest(tss: ['EUS'], surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', project: 'ETinET', sut: 11) {        
        stage ('docker container')
            def mycontainer = docker.image('elastest/ci-docker-compose-py-siblings:latest')
            mycontainer.pull()
            mycontainer.inside("-u jenkins -v /var/run/docker.sock:/var/run/docker.sock:rw -v /dev/shm:/dev/shm")  {
                sh '/usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf &'
                
                stage ('prepare test')
                        git 'https://github.com/elastest/elastest-bigdata-service.git'
                        elastest.connect2ElastestNetwork()

                        def elastestUser = elastest.getElasTestUser()
                        def elastestPass = elastest.getElasTestPassword()
                        
                        elastest_url = "http://" + elastestUser +":"+ elastestPass+"@"+elastest.getIp()+":"+elastest.getPort()
                        sh "env | sort"    
                  }
}
